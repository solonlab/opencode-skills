# 配色协同机制

当 image-service 与其他 skill 配合使用时（如 pptx、docx、obsidian 等），**必须感知上下文配色方案并自动适配**，确保生成的图片与目标载体风格统一。

## 协同原则

1. **主动感知**：生成配图前，先确认目标载体的配色方案
2. **自动适配**：将配色信息融入图片生成提示词
3. **风格统一**：背景色、主色调、强调色保持一致

## 配色来源优先级

| 优先级 | 来源 | 说明 |
|-------|------|------|
| 1 | 用户明确指定 | 用户直接提供的颜色值 |
| 2 | 当前任务上下文 | 正在制作的 PPT/文档的配色方案 |
| 3 | 项目配置文件 | `.design/palette.json` 或类似配置 |
| 4 | 默认风格 | 手绘白底风格（无特殊要求时） |

## 与 PPTX 协同

制作 PPT 配图时，从 pptx skill 的设计方案中提取配色：

```markdown
# 示例：PPT 配色方案
- 背景色：#181B24（深蓝黑）
- 主色：#B165FB（紫色）
- 辅助色：#40695B（翡翠绿）
- 文字色：#FFFFFF / #AAAAAA
```

生成图片时，将配色融入提示词：

```bash
# 错误示例（不考虑配色）
python scripts/text_to_image.py "流程图，用户路径变化" -r 16:9

# 正确示例（融入配色）
python scripts/text_to_image.py "信息图风格，深色背景#181B24，科技感流程图。用紫色#B165FB和翡翠绿#40695B作为强调色，展示用户路径变化，发光线条风格，中文标签" -r 16:9
```

## 与其他 Skill 协同

| 目标载体 | 配色来源 | 适配要点 |
|---------|---------|---------|
| **PPTX** | HTML slides 的 CSS 配色 | 背景色、强调色、文字色统一 |
| **DOCX** | 文档主题色或用户指定 | 配合文档正式/活泼风格 |
| **Obsidian** | Vault 主题（深色/浅色） | 适配笔记阅读体验 |
| **小红书** | 品牌色或内容调性 | 竖版 3:4，吸睛配色 |
| **调研报告** | 统一手绘风格 | 使用 research_image.py 预设 |

## 配色提示词模板

```
信息图风格，{背景描述}背景{背景色}，{风格描述}。
使用{主色}作为主色调，{辅助色}作为辅助色。
{内容描述}，{视觉风格}，中文标签。
```

**示例**：
```
信息图风格，深色背景#181B24，科技感对比图。
使用紫色#B165FB作为主色调，翡翠绿#40695B作为辅助色。
左侧展示SEO特点，右侧展示GEO特点，发光连接线风格，中文标签。
```

## Agent 执行规范

1. **识别协同场景**：检测是否在为其他 skill 生成配图
2. **提取配色方案**：从上下文/HTML/配置中获取颜色值
3. **构建适配提示词**：将配色信息自然融入生成描述
4. **验证风格一致**：生成后确认与目标载体视觉协调

## 协同执行流程

1. 确认目标载体 → 2. 提取配色方案 → 3. 融入提示词 → 4. 生成适配图片
